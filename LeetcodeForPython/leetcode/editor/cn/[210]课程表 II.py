from typing import *

# ç°åœ¨ä½ æ€»å…±æœ‰ n é—¨è¯¾éœ€è¦é€‰ï¼Œè®°ä¸º 0 åˆ° n-1ã€‚
# 
#  åœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºä»–ä»¬: [0,1] 
# 
#  ç»™å®šè¯¾ç¨‹æ€»é‡ä»¥åŠå®ƒä»¬çš„å…ˆå†³æ¡ä»¶ï¼Œè¿”å›ä½ ä¸ºäº†å­¦å®Œæ‰€æœ‰è¯¾ç¨‹æ‰€å®‰æ’çš„å­¦ä¹ é¡ºåºã€‚ 
# 
#  å¯èƒ½ä¼šæœ‰å¤šä¸ªæ­£ç¡®çš„é¡ºåºï¼Œä½ åªè¦è¿”å›ä¸€ç§å°±å¯ä»¥äº†ã€‚å¦‚æœä¸å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹ï¼Œè¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚ 
# 
#  ç¤ºä¾‹ 1: 
# 
#  è¾“å…¥: 2, [[1,0]] 
# è¾“å‡º: [0,1]
# è§£é‡Š:Â æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ 1ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºä¸º [0,1] ã€‚ 
# 
#  ç¤ºä¾‹ 2: 
# 
#  è¾“å…¥: 4, [[1,0],[2,0],[3,1],[3,2]]
# è¾“å‡º: [0,1,2,3] or [0,2,1,3]
# è§£é‡Š:Â æ€»å…±æœ‰ 4 é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ 3ï¼Œä½ åº”è¯¥å…ˆå®Œæˆè¯¾ç¨‹ 1 å’Œè¯¾ç¨‹ 2ã€‚å¹¶ä¸”è¯¾ç¨‹ 1 å’Œè¯¾ç¨‹ 2 éƒ½åº”è¯¥æ’åœ¨è¯¾ç¨‹ 0 ä¹‹åã€‚
# Â     å› æ­¤ï¼Œä¸€ä¸ªæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºæ˜¯Â [0,1,2,3] ã€‚å¦ä¸€ä¸ªæ­£ç¡®çš„æ’åºæ˜¯Â [0,2,1,3] ã€‚
#  
# 
#  è¯´æ˜: 
# 
#  
#  è¾“å…¥çš„å…ˆå†³æ¡ä»¶æ˜¯ç”±è¾¹ç¼˜åˆ—è¡¨è¡¨ç¤ºçš„å›¾å½¢ï¼Œè€Œä¸æ˜¯é‚»æ¥çŸ©é˜µã€‚è¯¦æƒ…è¯·å‚è§å›¾çš„è¡¨ç¤ºæ³•ã€‚ 
#  ä½ å¯ä»¥å‡å®šè¾“å…¥çš„å…ˆå†³æ¡ä»¶ä¸­æ²¡æœ‰é‡å¤çš„è¾¹ã€‚ 
#  
# 
#  æç¤º: 
# 
#  
#  è¿™ä¸ªé—®é¢˜ç›¸å½“äºæŸ¥æ‰¾ä¸€ä¸ªå¾ªç¯æ˜¯å¦å­˜åœ¨äºæœ‰å‘å›¾ä¸­ã€‚å¦‚æœå­˜åœ¨å¾ªç¯ï¼Œåˆ™ä¸å­˜åœ¨æ‹“æ‰‘æ’åºï¼Œå› æ­¤ä¸å¯èƒ½é€‰å–æ‰€æœ‰è¯¾ç¨‹è¿›è¡Œå­¦ä¹ ã€‚ 
#  é€šè¿‡ DFS è¿›è¡Œæ‹“æ‰‘æ’åº - ä¸€ä¸ªå…³äºCourseraçš„ç²¾å½©è§†é¢‘æ•™ç¨‹ï¼ˆ21åˆ†é’Ÿï¼‰ï¼Œä»‹ç»æ‹“æ‰‘æ’åºçš„åŸºæœ¬æ¦‚å¿µã€‚ 
#  
#  æ‹“æ‰‘æ’åºä¹Ÿå¯ä»¥é€šè¿‡ BFS å®Œæˆã€‚ 
#  
#  
#  Related Topics æ·±åº¦ä¼˜å…ˆæœç´¢ å¹¿åº¦ä¼˜å…ˆæœç´¢ å›¾ æ‹“æ‰‘æ’åº 
#  ğŸ‘ 282 ğŸ‘ 0


# leetcode submit region begin(Prohibit modification and deletion)
import collections


class Solution:
    def findOrder(self, numCourses: int, prerequisites: List[List[int]]) -> List[int]:
        # æ‹“æ‰‘æ’åº | dfs
        # é‚»æ¥è¡¨
        neigh = [set() for _ in range(numCourses)]
        for i, j in prerequisites:
            neigh[j].add(i)

        white, gray, black = 0, 1, 2  # æœªè®¿é—®ï¼Œåœ¨ç¯ä¸­ï¼Œå·²è®¿é—®
        color = collections.defaultdict(int)  # ä¿å­˜nodeçš„è®¿é—®çŠ¶æ€
        deque = collections.deque()  # åŒç«¯é˜Ÿåˆ—ä»å·¦ä¾§æ·»åŠ ç»“æœ

        # å¯¹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œæ‹“æ‰‘æ’åºï¼Œè¿”å›å€¼ä¸ºfalseï¼Œè¯´æ˜å­˜åœ¨ç¯ï¼Œæœ¬å›¾ä¸èƒ½å®Œæˆæ‹“æ‰‘æ’åº
        def dfs(node: int) -> bool:
            if color[node] != white:
                return color[node] == black  # å¦‚æœè¢«è®¿é—®è¿‡ï¼Œä¸”ä¸åœ¨ç¯ä¸­è¿”å›Trueï¼Œæ— æ³•å¯¹æ­¤èŠ‚ç‚¹æ·±æœ

            color[node] = gray
            for nei in neigh[node]:
                # å¦‚æœé‚»æ¥ç‚¹æˆç¯ï¼Œæˆ–è€…é‚»æ¥ç‚¹çš„é‚»æ¥ç‚¹æˆç¯ï¼Œè¿”å›false
                if color[nei] == gray or not dfs(nei): return False

            # å¦‚æœä»¥ä¸Šåˆ¤æ–­æ— é—®é¢˜ï¼Œå°†nodeå…¥åˆ—
            deque.appendleft(node)
            color[node] = black
            return True

        for i in range(numCourses):
            # å¦‚æœèŠ‚ç‚¹æ²¡æœ‰è¢«è®¿é—®ä¸”dfsè¿”å›Falseï¼Œè¯´æ˜å›¾ä¸èƒ½è¿›è¡Œæ‹“æ‰‘æ’åºï¼Œè¿”å›ç©ºæ•°ç»„
            if color[i] == white and not dfs(i): return []

        return list(deque)


# leetcode submit region end(Prohibit modification and deletion)


if __name__ == "__main__":
    pass
